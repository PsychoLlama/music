// Generated by CoffeeScript 1.7.1
(function() {
  'use strict';
  var clean, fireSongEvent, makeAudio, resetSongs, root;

  root = this;

  makeAudio = function(song) {
    var audio;
    audio = new Audio();
    if (song.src) {
      audio.src = song.src;
    }
    if (song.title) {
      audio.setAttribute('data-title', song.title);
    }
    if (song.img) {
      audio.setAttribute('data-img', song.img);
    }
    return audio;
  };

  fireSongEvent = function(instance) {
    var callback, _i, _len, _ref, _results;
    try {
      _ref = instance.callbacks;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        callback = _ref[_i];
        _results.push(callback(instance.getSong()));
      }
      return _results;
    } catch (_error) {}
  };

  clean = function(array) {
    var value, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = array.length; _i < _len; _i++) {
      value = array[_i];
      if (value) {
        _results.push(value);
      }
    }
    return _results;
  };

  resetSongs = function(instance) {
    var playlist, song, _i, _len;
    playlist = instance.songs;
    for (_i = 0, _len = playlist.length; _i < _len; _i++) {
      song = playlist[_i];
      try {
        song.pause();
        song.currentTime = 0;
      } catch (_error) {}
    }
    return instance;
  };

  root.Playlist = function(name) {
    if (name == null) {
      name = '';
    }
    this.name = name;
    this.repeatState = false;
    this.songs = [];
    this.songNumber = 0;
    this.callbacks = [];
    return this;
  };

  root.Playlist.prototype = {
    constructor: root.Playlist,
    songChange: function(callback) {
      this.callbacks.push(callback);
      return this;
    },
    shuffle: function() {
      this.songNumber = 0;
      this.songs.sort(function() {
        return (Math.floor(Math.random() * 3)) - 1;
      });
      resetSongs(this);
      fireSongEvent(this);
      return this;
    },
    play: function() {
      var song;
      song = this.getSong();
      if (song != null) {
        song.play();
      }
      return this;
    },
    pause: function() {
      var song;
      song = this.getSong();
      if (song != null) {
        song.pause();
      }
      return this;
    },
    next: function() {
      var lastSong, onLastSong;
      lastSong = this.songs.length - 1;
      onLastSong = this.songNumber === lastSong;
      if (onLastSong && this.repeat() === true) {
        return this.skipTo(0);
      }
      if (onLastSong && this.repeat() === false) {
        return void 0;
      } else if (this.songNumber < lastSong) {
        return this.skipTo(this.songNumber + 1);
      }
    },
    previous: function() {
      var audio;
      audio = this.getSong();
      if (audio.currentTime > 5) {
        resetSongs(this);
        return this;
      }
      if (this.songNumber === 0 && this.repeat() === true) {
        return this.skipTo(this.songs.length - 1);
      }
      if (this.songNumber > 0) {
        return this.skipTo(this.songNumber - 1);
      }
    },
    skipTo: function(songNum) {
      if (songNum >= this.songs.length) {
        return void 0;
      }
      if (songNum < 0) {
        return void 0;
      }
      if (songNum || songNum === 0) {
        resetSongs(this);
        this.songNumber = songNum;
        fireSongEvent(this);
        return this;
      }
    },
    repeat: function(bool) {
      if (bool === void 0) {
        return this.repeatState;
      }
      if (typeof bool === 'boolean') {
        this.repeatState = bool;
      }
      return this;
    },
    getSong: function(songNum) {
      if (!songNum) {
        return this.songs[this.songNumber];
      }
      if (songNum >= 0 && songNum < this.songs.length) {
        return this.songs[songNum];
      }
    },
    album: function(audio) {
      var img, src;
      if (audio == null) {
        audio = this.getSong();
      }
      src = audio.getAttribute('data-img');
      if (src === null) {
        return;
      }
      img = document.createElement('img');
      img.src = src;
      return img;
    },
    title: function(audio) {
      var songTitle;
      if (audio == null) {
        audio = this.getSong();
      }
      songTitle = audio.getAttribute('data-title');
      if (songTitle) {
        return songTitle;
      } else {
        return void 0;
      }
    },
    add: function(data) {
      var song, _i, _len;
      if (typeof data !== 'object') {
        return null;
      }
      if (data.length > 0) {
        for (_i = 0, _len = data.length; _i < _len; _i++) {
          song = data[_i];
          this.songs.push(makeAudio(song));
        }
      } else if (data.tagName === 'AUDIO') {
        this.songs.push(data);
      } else {
        this.songs.push(makeAudio(data));
      }
      fireSongEvent(this);
      return this;
    },
    remove: function(songNum) {
      if ((0 <= songNum && songNum < this.songs.length)) {
        delete this.songs[songNum];
        this.songs = clean(this.songs);
        fireSongEvent(this);
        if (this.songNumber === songNum) {
          this.songNumber = 0;
        } else if (this.songNumber > songNum) {
          this.songNumber--;
        }
        return this;
      }
    },
    each: function(callback) {
      var song, _i, _len, _ref;
      try {
        _ref = this.songs;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          song = _ref[_i];
          callback(song, _i);
        }
      } catch (_error) {}
      return this;
    }
  };

}).call(this);
